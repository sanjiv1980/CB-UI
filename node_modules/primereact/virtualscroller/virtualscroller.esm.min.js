import*as e from"react";import{usePrevious as t,useResizeListener as r,useEventListener as n,useMountEffect as o,useUpdateEffect as l}from"primereact/hooks";import{ObjectUtils as i,DomHandler as s,classNames as c}from"primereact/utils";function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a.apply(this,arguments)}function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function f(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function m(e){var t=f(e,"string");return"symbol"===u(t)?t:String(t)}function d(e,t,r){return(t=m(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){if(Array.isArray(e))return e}function g(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,l,i,s=[],c=!0,a=!1;try{if(l=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=l.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){a=!0,o=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(a)throw o}}return s}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){if(e){if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?h(e,t):void 0}}function y(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){return p(e)||g(e,t)||v(e,t)||y()}var S={defaultProps:{__TYPE:"VirtualScroller",id:null,style:null,className:null,items:null,itemSize:0,scrollHeight:null,scrollWidth:null,orientation:"vertical",numToleratedItems:null,delay:0,resizeDelay:10,lazy:!1,disabled:!1,loaderDisabled:!1,columns:null,loading:void 0,autoSize:!1,showSpacer:!0,showLoader:!1,loadingTemplate:null,loaderIconTemplate:null,itemTemplate:null,contentTemplate:null,onScroll:null,onScrollIndexChange:null,onLazyLoad:null,children:void 0},getProps:function(e){return i.getMergedProps(e,S.defaultProps)},getOtherProps:function(e){return i.getDiffProps(e,S.defaultProps)}};function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function z(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var T=e.memo(e.forwardRef((function(u,f){var m=S.getProps(u),d="vertical"===m.orientation,p="horizontal"===m.orientation,g="both"===m.orientation,h=w(e.useState(g?{rows:0,cols:0}:0),2),v=h[0],y=h[1],b=w(e.useState(g?{rows:0,cols:0}:0),2),T=b[0],I=b[1],O=w(e.useState(g?{rows:0,cols:0}:0),2),x=O[0],P=O[1],E=w(e.useState(m.numToleratedItems),2),R=E[0],j=E[1],L=w(e.useState(m.loading||!1),2),H=L[0],M=L[1],D=w(e.useState([]),2),N=D[0],W=D[1],A=e.useRef(null),C=e.useRef(null),k=e.useRef(null),J=e.useRef(null),V=e.useRef(g?{top:0,left:0}:0),X=e.useRef(null),F=e.useRef(null),_=e.useRef(null),B=e.useRef(null),U=t(m.items),Y=t(m.loading),$=w(r({listener:function(e){return ue()}}),1)[0],q=w(n({target:"window",type:"orientationchange",listener:function(e){return ue()}}),1)[0],G=function(){return A},K=function(e){V.current=g?{top:0,left:0}:0,A.current&&A.current.scrollTo(e)},Q=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",r=te(),n=r.numToleratedItems,o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return e<=t?0:e},l=function(e,t){return e*t},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K({left:e,top:r,behavior:t})};if(g){var s={rows:o(e[0],n[0]),cols:o(e[1],n[1])};s.rows===v.rows&&s.cols===v.cols||i(l(s.cols,m.itemSize[1]),l(s.rows,m.itemSize[0]))}else{var c=o(e,n);c!==v&&(p?i(l(c,m.itemSize),0):i(0,l(c,m.itemSize)))}},Z=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(t){var n=ee(),o=n.first,l=n.viewport,i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K({left:e,top:t,behavior:r})},s="to-start"===t,c="to-end"===t;if(s){if(g)l.first.rows-o.rows>e[0]?i(l.first.cols*m.itemSize[1],(l.first.rows-1)*m.itemSize[0]):l.first.cols-o.cols>e[1]&&i((l.first.cols-1)*m.itemSize[1],l.first.rows*m.itemSize[0]);else if(l.first-o>e){var a=(l.first-1)*m.itemSize;p?i(a,0):i(0,a)}}else if(c)if(g)l.last.rows-o.rows<=e[0]+1?i(l.first.cols*m.itemSize[1],(l.first.rows+1)*m.itemSize[0]):l.last.cols-o.cols<=e[1]+1&&i((l.first.cols+1)*m.itemSize[1],l.first.rows*m.itemSize[0]);else if(l.last-o<=e+1){var u=(l.first+1)*m.itemSize;p?i(u,0):i(0,u)}}else Q(e,r)},ee=function(){var e=function(e,t){return Math.floor(e/(t||e))},t=v,r=0;if(A.current){var n=A.current,o=n.scrollTop,l=n.scrollLeft;if(g)r={rows:(t={rows:e(o,m.itemSize[0]),cols:e(l,m.itemSize[1])}).rows+x.rows,cols:t.cols+x.cols};else r=(t=e(p?l:o,m.itemSize))+x}return{first:v,last:T,viewport:{first:t,last:r}}},te=function(){var e=oe(),t=A.current?A.current.offsetWidth-e.left:0,r=A.current?A.current.offsetHeight-e.top:0,n=function(e,t){return Math.ceil(e/(t||e))},o=function(e){return Math.ceil(e/2)},l=g?{rows:n(r,m.itemSize[0]),cols:n(t,m.itemSize[1])}:n(p?t:r,m.itemSize);return{numItemsInViewport:l,numToleratedItems:R||(g?[o(l.rows),o(l.cols)]:o(l))}},re=function(e){m.autoSize&&!e&&Promise.resolve().then((function(){if(C.current){C.current.style.minHeight=C.current.style.minWidth="auto";var e=C.current,t=e.offsetWidth,r=e.offsetHeight;(g||p)&&(A.current.style.width=(t<_.current?t:_.current)+"px"),(g||d)&&(A.current.style.height=(r<B.current?r:B.current)+"px"),C.current.style.minHeight=C.current.style.minWidth=""}}))},ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return m.items?Math.min(t?(m.columns||m.items[0]).length:m.items.length,e):0},oe=function(){if(C.current){var e=getComputedStyle(C.current),t=parseInt(e.paddingLeft,10)+Math.max(parseInt(e.left,10),0),r=parseInt(e.paddingRight,10)+Math.max(parseInt(e.right,10),0),n=parseInt(e.paddingTop,10)+Math.max(parseInt(e.top,10),0),o=parseInt(e.paddingBottom,10)+Math.max(parseInt(e.bottom,10),0);return{left:t,right:r,top:n,bottom:o,x:t+r,y:n+o}}return{left:0,right:0,top:0,bottom:0,x:0,y:0}},le=function(){if(A.current){var e=A.current.parentElement,t=m.scrollWidth||"".concat(A.current.offsetWidth||e.offsetWidth,"px"),r=m.scrollHeight||"".concat(A.current.offsetHeight||e.offsetHeight,"px"),n=function(e,t){return A.current.style[e]=t};g||p?(n("height",r),n("width",t)):n("height",r)}},ie=function(){var e=m.items;if(k.current&&e){var t=oe(),r=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return k.current.style[e]=(t||[]).length*r+n+"px"};g?(r("height",e,m.itemSize[0],t.y),r("width",m.columns||e[1],m.itemSize[1],t.x)):p?r("width",m.columns||e,m.itemSize,t.x):r("height",e,m.itemSize,t.y)}},se=function(e){if(C.current){var t=e?e.first:v,r=function(e,t){return e*t},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;J.current&&(J.current.style.top="-".concat(t,"px")),C.current.style.transform="translate3d(".concat(e,"px, ").concat(t,"px, 0)")};if(g)n(r(t.cols,m.itemSize[1]),r(t.rows,m.itemSize[0]));else{var o=r(t,m.itemSize);p?n(o,0):n(0,o)}}},ce=function(e){var t=e.target,r=oe(),n=function(e,t){return e?e>t?e-t:e:0},o=function(e,t){return Math.floor(e/(t||e))},l=function(e,t,r,n,o,l){return e<=o?o:l?r-n-o:t+o-1},i=function(e,t,r,n,o,l,i){return e<=l?0:Math.max(0,i?e<t?r:e-l:e>t?r:e-2*l)},s=function(e,t,r,n,o,l){var i=t+n+2*o;return e>=o&&(i+=o+1),ne(i,l)},c=n(t.scrollTop,r.top),a=n(t.scrollLeft,r.left),u=g?{rows:0,cols:0}:0,f=T,d=!1,h=V.current;if(g){var y=V.current.top<=c,w=V.current.left<=a,S={rows:o(c,m.itemSize[0]),cols:o(a,m.itemSize[1])},b={rows:l(S.rows,v.rows,T.rows,x.rows,R[0],y),cols:l(S.cols,v.cols,T.cols,x.cols,R[1],w)};u={rows:i(S.rows,b.rows,v.rows,0,0,R[0],y),cols:i(S.cols,b.cols,v.cols,0,0,R[1],w)},f={rows:s(S.rows,u.rows,0,x.rows,R[0]),cols:s(S.cols,u.cols,0,x.cols,R[1],!0)},d=u.rows!==v.rows||f.rows!==T.rows||u.cols!==v.cols||f.cols!==T.cols,h={top:c,left:a}}else{var z=p?a:c,I=V.current<=z,O=o(z,m.itemSize);f=s(O,u=i(O,l(O,v,T,x,R,I),v,0,0,R,I),0,x,R),d=u!==v||f!==T,h=z}return{first:u,last:f,isRangeChanged:d,scrollPos:h}},ae=function(e){var t=ce(e),r=t.first,n=t.last,o=t.scrollPos;if(t.isRangeChanged){var l={first:r,last:n};se(l),y(r),I(n),V.current=o,m.onScrollIndexChange&&m.onScrollIndexChange(l),m.lazy&&m.onLazyLoad&&m.onLazyLoad(l)}},ue=function(){F.current&&clearTimeout(F.current),F.current=setTimeout((function(){if(A.current){var e=[s.getWidth(A.current),s.getHeight(A.current)],t=e[0],r=e[1],n=t!==_.current,o=r!==B.current;(g?n||o:p?n:!!d&&o)&&(j(m.numToleratedItems),_.current=t,B.current=r)}}),m.resizeDelay)},fe=function(e){var t=(m.items||[]).length,r=g?v.rows+e:v+e;return{index:r,count:t,first:0===r,last:r===t-1,even:r%2==0,odd:r%2!=0,props:m}},me=function(e,t){var r=N.length;return z({index:e,count:r,first:0===e,last:e===r-1,even:e%2==0,odd:e%2!=0,props:m},t)},de=function(){var e=m.items;return e&&!H?g?e.slice(v.rows,T.rows).map((function(e){return m.columns?e:e.slice(v.cols,T.cols)})):p&&m.columns?e:e.slice(v,T):[]},pe=function(){var e,t,r,n,o;m.disabled||(le(),e=te(),t=e.numItemsInViewport,r=e.numToleratedItems,n=function(e,t,r,n){return ne(e+t+(e<r?2:3)*r,n)},o=g?{rows:n(v.rows,t.rows,r[0]),cols:n(v.cols,t.cols,r[1],!0)}:n(v,t,r),P(t),j(r),I(o),m.showLoader&&W(g?Array.from({length:t.rows}).map((function(){return Array.from({length:t.cols})})):Array.from({length:t})),m.lazy&&m.onLazyLoad&&m.onLazyLoad({first:v,last:o}),ie())};o((function(){m.disabled||(pe(),$(),q(),_.current=s.getWidth(A.current),B.current=s.getHeight(A.current))})),l((function(){pe()}),[m.itemSize,m.scrollHeight]),l((function(){m.numToleratedItems!==R&&j(m.numToleratedItems)}),[m.numToleratedItems]),l((function(){m.numToleratedItems===R&&pe()}),[R]),l((function(){U&&U.length===(m.items||[]).length||pe();var e=H;m.lazy&&Y!==m.loading&&m.loading!==H&&(M(m.loading),e=m.loading),re(e)})),l((function(){V.current=g?{top:0,left:0}:0}),[m.orientation]),e.useImperativeHandle(f,(function(){return{props:m,getElementRef:G,scrollTo:K,scrollToIndex:Q,scrollInView:Z,getRenderedRange:ee}}));var ge=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=me(t,r),o=i.getJSXElement(m.loadingTemplate,n);return e.createElement(e.Fragment,{key:t},o)},he=function(t,r){var n=fe(r),o=i.getJSXElement(m.itemTemplate,t,n);return e.createElement(e.Fragment,{key:n.index},o)};if(m.disabled){var ve=i.getJSXElement(m.contentTemplate,{items:m.items,rows:m.items,columns:m.columns});return e.createElement(e.Fragment,null,m.children,ve)}var ye=S.getOtherProps(m),we=c("p-virtualscroller",{"p-both-scroll":g,"p-virtualscroller-both":g,"p-virtualscroller-horizontal":p,"p-horizontal-scroll":p},m.className),Se=function(){if(!m.loaderDisabled&&m.showLoader&&H){var t=c("p-virtualscroller-loader",{"p-component-overlay":!m.loadingTemplate}),r=e.createElement("i",{className:"p-virtualscroller-loading-icon pi pi-spinner pi-spin"});return m.loadingTemplate?r=N.map((function(e,t){return ge(t,g&&{numCols:x.cols})})):m.loaderIconTemplate&&(r=i.getJSXElement(m.loaderIconTemplate,{className:"p-virtualscroller-loading-icon",element:r,props:m})),e.createElement("div",{className:t},r)}return null}(),be=function(){var t=de().map(he),r=c("p-virtualscroller-content",{"p-virtualscroller-loading":H}),n=e.createElement("div",{ref:C,className:r},t);if(m.contentTemplate){var o={className:r,contentRef:function(e){return C.current=i.getRefElement(e)},spacerRef:function(e){return k.current=i.getRefElement(e)},stickyRef:function(e){return J.current=i.getRefElement(e)},items:de(),getItemOptions:function(e){return fe(e)},children:t,element:n,props:m,loading:H,getLoaderOptions:function(e,t){return me(e,t)},loadingTemplate:m.loadingTemplate,itemSize:m.itemSize,rows:H?m.loaderDisabled?N:[]:de(),columns:m.columns&&g||p?H&&m.loaderDisabled?g?N[0]:N:m.columns.slice(g?v.cols:v,g?T.cols:T):m.columns,vertical:d,horizontal:p,both:g};return i.getJSXElement(m.contentTemplate,o)}return n}(),ze=m.showSpacer?e.createElement("div",{ref:k,className:"p-virtualscroller-spacer"}):null;return e.createElement("div",a({ref:A,className:we,tabIndex:0,style:m.style},ye,{onScroll:function(e){m.onScroll&&m.onScroll(e),m.delay?(X.current&&clearTimeout(X.current),!H&&m.showLoader&&ce(e).isRangeChanged&&M(!0),X.current=setTimeout((function(){ae(e),!H||!m.showLoader||m.lazy&&void 0!==m.loading||M(!1)}),m.delay)):ae(e)}}),be,ze,Se)})));T.displayName="VirtualScroller";export{T as VirtualScroller};
